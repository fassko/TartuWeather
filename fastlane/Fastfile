update_fastlane
default_platform :ios

platform :ios do
  before_all do
    # cocoapods
  end
  
  lane :certifiations do
    match(type: "appstore")
    match(type: "development")
  end

  lane :travis do
    build
  end

  lane :build do
    certifiations
    sigh
    
    increment_build_number(
      build_number: Time.new.strftime("%Y%m%d.%H%M%S")
    )
    
    clear_derived_data
    
    gym(
      workspace: "TartuWeather.xcworkspace",
      scheme: "TartuWeather",
      clean: true,
      output_name: "TartuWeather.ipa"
    )
  end

  lane :release do
    certifiations
    sigh

    increment_build_number(
      build_number: Time.new.strftime("%Y%m%d.%H%M%S")
    )
    
    clear_derived_data

    gym(
      workspace: "TartuWeather.xcworkspace",
      scheme: "TartuWeather",
      clean: true,
      output_name: "TartuWeather.ipa",
      include_symbols: true
    )

    dsym_zip

    copy_artifacts(
      target_path: 'artifacts',
      artifacts: ['*.dSYM.zip']
    )

    deliver
  end
  
  lane :unitTests do
    scan(
      workspace: "TartuWeather.xcworkspace",
      scheme: "UnitTests",
      device: "iPhone 7"
    )
  end
  
  lane :interfaceTests do
    scan(
      workspace: "TartuWeather.xcworkspace",
      scheme: "UXTests",
      device: "iPhone 7"
    )
  end

  after_all do |lane|

  end

  error do |lane, exception|

  end
end
